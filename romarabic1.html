<!DOCTYPE html>
<html lang='en'>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>One Apostrophe Arabic Transliteration</title>
</head>
<body>
	<h1>Arabic to Latin Transliteration</h1>
	<div id='arabicScriptRegion'>
		<label for='arabicScriptText'>Put text in Arabic script here.</label>
		<textarea id='arabicScriptText' dir="rtl" lang="ar" aria-live="assertive"></textarea>
		<input type='button' id='romanizeButton' value="Convert to Latin Script"/>
	</div>
	<div>
		<label for='latinScriptText'>Put text in Latin script here.</label>
		<textarea id='latinScriptText' dir="ltr" lang="en" aria-live="assertive"></textarea>
		<input type='button' id='arabizeButton' value="Convert to Arabic Script"/>
	</div>
	<input type='button' id='startDeveloperModeButton' value ="Start Developer Mode" style="visibility:collapse"/>
	<div id="developerPanel" style="visibility: collapse;">
		<input type='button' id='testButton' value="Run Unit Tests"/>
		<div id="testResultLabel"></div>
	</div>
		<footer>
		<p><a style="font-size: x-small; margin-left: 5em" href="https://github.com/elsanussi-s-mneina/one-apostrophe-arabic-transliteration-html-js">Get source code and documentation: v1.00, (2021-01-26). Made by Elsanussi Mneina</a></p>
		</footer>  
	<script>
		// pre-romanization exclusion characters are arabic characters that must be deleted before
		// romanization is started. They have no use in the Latin script.
		const preRomanizationExclusions = 
			[
			'\u0640' // ARABIC TATWEEL
			];

		const transliterationTable = 
			[
			["y'y'i", '\u0625\u0651\u0650'] // ARABIC LETTER ALEF WITH HAMZA BELOW followed by ARABIC SHADDA and ARABIC KASRA
			,["y'i", '\u0625\u0650'] // ARABIC LETTER ALEF WITH HAMZA BELOW followed by ARABIC KASRA
			,["y'y'i", '\u0625\u0651'] // ARABIC LETTER ALEF WITH HAMZA BELOW then ARABIC SHADDA
			,["y'i", '\u0625'] // ARABIC LETTER ALEF WITH HAMZA BELOW
			,["y'aa", '\u0622'] // ARABIC LETTER ALEF WITH MADDA ABOVE
			,["y'y'", '\u0623\u0651'] // ARABIC LETTER ALEF WITH HAMZA ABOVE then ARABIC SHADDA
			,["y'", '\u0623'] // ARABIC LETTER ALEF WITH HAMZA ABOVE
			,["y'y'", '\u0621\u0651'] // ARABIC LETTER HAMZA then ARABIC SHADDA
			,["y'", '\u0621'] // ARABIC LETTER HAMZA
			,["y'y'", '\u0624\u0651'] // ARABIC LETTER WAW WITH HAMZA ABOVE then ARABIC SHADDA
			,["y'", '\u0624'] // ARABIC LETTER WAW WITH HAMZA ABOVE
			,["y'y'", '\u0626\u0651'] // ARABIC LETTER YEH WITH HAMZA ABOVE then ARABIC SHADDA
			,["y'", '\u0626'] // ARABIC LETTER YEH WITH HAMZA ABOVE

			// Note: due to the way the digraphs (i.e. sh, th, etc.) use h as a second character
			// the only way to represent the phoneme /h/ unambiguously in all positions is to add a dash before
			// in the Latin script. I try to recognize <h> without a dash before it as /h/ wherever
			// it could not be part of a digraph (because no digraph exists in the transliteration system).
			// This is not ideal, and the only way around it is to either have a highly unreadable transliteration system
			// or a readable one that uses diacritics that only an expert would be expected to figure out how to type.
			// Therefore this dash in <-h> is not morphological like <-n> and <-t>, instead it is an accident of the transliteration system.

			,["-h'h'", '\u062d\u0651'] // ARABIC LETTER HAH the ARABIC SHADDA
			,["-h'", '\u062d'] // ARABIC LETTER HAH

			,["-h", '\u0647'] // ARABIC LETTER HEH 

			,["a'a'", '\u0639\u0651'] // ARABIC LETTER AIN then ARABIC SHADDA
			,["a'", '\u0639'] // ARABIC LETTER AIN

			,["aai", '\u064e\u0627\u064a\u0652'] // ARABIC FATHA then ARABIC LETTER ALEF then ARABIC LETTER YEH then ARABIC SUKUN
			,["aa", '\u064e\u0627'] // ARABIC FATHA then ARABIC LETTER ALEF
			,["aa", '\u064e\u0670'] // ARABIC FATHA then ARABIC LETTER SUPERSCRIPT ALEF
			,["aa", '\u0670'] // ARABIC LETTER SUPERSCRIPT ALEF
			,["aa", '\u064e\u0649'] // ARABIC FATHA then ARABIC LETTER ALEF MAKSURA
			,["aa", '\u0649'] // ARABIC LETTER ALEF MAKSURA
			,["ai", '\u064e\u064a\u0652'] // ARABIC FATHA then ARABIC LETTER YEH then ARABIC SUKUN
			,["ii", '\u0650\u064a\u0652'] // ARABIC KASRA then ARABIC LETTER YEH then ARABIC SUKUN
			,["ii", '\u0650\u0656'] // ARABIC KASRA then ARABIC SUBSCRIPT ALEF
			,["ii", '\u0656'] // ARABIC SUBSCRIPT ALEF
			,["uu", '\u064f\u0648\u0652'] // ARABIC DAMMA then ARABIC LETTER WAW then ARABIC SUKUN
			,["bb", '\u0628\u0651'] // ARABIC LETTER BEH then SHADDA
			,["b", '\u0628'] // ARABIC LETTER BEH
			,["-tt", '\u0629\u0651'] // ARABIC LETTER TEH MARBUTA then SHADDA (this never happens in Standard Arabic but we support it for consistency sake, and because there is no logical reason it should not be possible.)
			,["-t", '\u0629'] // ARABIC LETTER TEH MARBUTA
			,["t't'", '\u0637\u0651'] // ARABIC LETTER TAH then ARABIC SHADDA
			,["t'", '\u0637'] // ARABIC LETTER TAH
			,["t-h'h'", '\u062b\u062d\u0651'] // ARABIC LETTER TEH then ARABIC LETTER HAH then ARABIC SHADDA
			,["th'h'", '\u062b\u062d\u0651'] // ARABIC LETTER TEH then ARABIC LETTER HAH then ARABIC SHADDA
			,["t-h'", '\u062b\u062d'] // ARABIC LETTER TEH then ARABIC LETTER HAH
			,["th'", '\u062b\u062d'] // ARABIC LETTER TEH then ARABIC LETTER HAH
			,["thth", '\u062b\u0651'] // ARABIC LETTER THEH then SHADDA
			,["th", '\u062b'] // ARABIC LETTER THEH
			,["tt", '\u062a\u0651'] // ARABIC LETTER TEH then ARABIC SHADDA
			,["t", '\u062a'] // ARABIC LETTER TEH
			,["jj", '\u062c\u0651'] // ARABIC LETTER JEEM then ARABIC SHADDA
			,["j", '\u062c'] // ARABIC LETTER JEEM
			,["h'h'", '\u062d\u0651'] // ARABIC LETTER HAH the ARABIC SHADDA
			,["h'", '\u062d'] // ARABIC LETTER HAH
			,["k-h'h'", '\u0643\u062d\u0651'] // ARABIC LETTER KAF then ARABIC LETTER HAH then ARABIC SHADDA
			,["kh'h'", '\u0643\u062d\u0651'] // ARABIC LETTER KAF then ARABIC LETTER HAH then ARABIC SHADDA
			,["k-h'", '\u0643\u062d'] // ARABIC LETTER KAF then ARABIC LETTER HAH
			,["kh'", '\u0643\u062d'] // ARABIC LETTER KAF then ARABIC LETTER HAH
			,["khkh", '\u062e\u0651'] // ARABIC LETTER KHAH then ARABIC SHADDA
			,["kh", '\u062e'] // ARABIC LETTER KHAH
			,["d-h'h'", '\u062f\u062d\u0651'] // ARABIC LETTER DAL then ARABIC LETTER HAH then ARABIC SHADDA
			,["dh'h'", '\u062f\u062d\u0651'] // ARABIC LETTER DAL then ARABIC LETTER HAH then ARABIC SHADDA
			,["d-h'", '\u062f\u062d'] // ARABIC LETTER DAL then ARABIC LETTER HAH
			,["dh'", '\u062f\u062d'] // ARABIC LETTER DAL then ARABIC LETTER HAH
			,["dhdh", '\u0630\u0651'] // ARABIC LETTER DHAL then ARABIC SHADDA
			,["dh", '\u0630'] // ARABIC LETTER DHAL
			,["d'd'", '\u0636\u0651'] // ARABIC LETTER DAD then ARABIC SHADDA
			,["d'", '\u0636'] // ARABIC LETTER DAD
			,["dd", '\u062f\u0651'] // ARABIC LETTER DAL then ARABIC SHADDA
			,["d", '\u062f'] // ARABIC LETTER DAL
			,["rr", '\u0631\u0651'] // ARABIC LETTER REH then ARABIC SHADDA
			,["r", '\u0631'] // ARABIC LETTER REH
			,["z'z'", '\u0638\u0651'] // ARABIC LETTER ZAH then ARABIC SHADDA
			,["z'", '\u0638'] // ARABIC LETTER ZAH
			,["zz", '\u0632\u0651'] // ARABIC LETTER ZAIN then ARABIC SHADDA
			,["z", '\u0632'] // ARABIC LETTER ZAIN
			,["s-h'h'", '\u0633\u062d\u0651'] // ARABIC LETTER SHEEN then ARABIC LETTER HAH then ARABIC SHADDA
			,["sh'h'", '\u0633\u062d\u0651'] // ARABIC LETTER SHEEN then ARABIC LETTER HAH then ARABIC SHADDA
			,["s-h'", '\u0633\u062d'] // ARABIC LETTER SHEEN then ARABIC LETTER HAH
			,["sh'", '\u0633\u062d'] // ARABIC LETTER SHEEN then ARABIC LETTER HAH
			,["shsh", '\u0634\u0651'] // ARABIC LETTER SHEEN then ARABIC SHADDA
			,["sh", '\u0634'] // ARABIC LETTER SHEEN
			,["s's'", '\u0635\u0651'] // ARABIC LETTER SAD then ARABIC SHADDA
			,["s'", '\u0635'] // ARABIC LETTER SAD
			,["ss", '\u0633\u0651'] // ARABIC LETTER SEEN then ARABIC SHADDA
			,["s", '\u0633'] // ARABIC LETTER SEEN
			,["ghgh", '\u063a\u0651'] // ARABIC LETTER GHAIN then ARABIC SHADDA
			,["gh", '\u063a'] // ARABIC LETTER GHAIN
			,["ff", '\u0641\u0651'] // ARABIC LETTER FEH then ARABIC SHADDA
			,["f", '\u0641'] // ARABIC LETTER FEH
			,["qq", '\u0642\u0651'] // ARABIC LETTER QAF then ARABIC SHADDA
			,["q", '\u0642'] // ARABIC LETTER QAF
			,["kk", '\u0643\u0651'] // ARABIC LETTER KAF then ARABIC SHADDA
			,["k", '\u0643'] // ARABIC LETTER KAF
			,["ll", '\u0644\u0651'] // ARABIC LETTER LAM then ARABIC SHADDA
			,["l", '\u0644'] // ARABIC LETTER LAM
			,["mm", '\u0645\u0651'] // ARABIC LETTER MEEM then ARABIC SHADDA
			,["m", '\u0645'] // ARABIC LETTER MEEM
			,["nn", '\u0646\u0651'] // ARABIC LETTER NOON then ARABIC SHADDA
			,["n", '\u0646'] // ARABIC LETTER NOON
			,["hh", '\u0647\u0651'] // ARABIC LETTER HEH then ARABIC SHADDA
			,["h", '\u0647'] // ARABIC LETTER HEH
			,["ww", '\u0648\u0651'] // ARABIC LETTER WAW then ARABIC SHADDA
			,["w", '\u0648'] // ARABIC LETTER WAW
			,["yy", '\u064a\u0651'] // ARABIC LETTER YEH then ARABIC SHADDA
			,["y", '\u064a'] // ARABIC LETTER YEH
			,["a-n", '\u064b'] // ARABIC FATHATAN
			,["u-n", '\u064c'] // ARABIC DAMMATAN
			,["i-n", '\u064d'] // ARABIC KASRATAN
			,["a", '\u064e'] // ARABIC FATHA
			,["u", '\u064f'] // ARABIC DAMMA
			,["i", '\u0650'] // ARABIC KASRA
			,[',', '\u060c'] // ARABIC COMMA
			,[';', '\u061b'] // ARABIC SEMICOLON
			,['?', '\u061f'] // ARABIC QUESTION MARK
			,['.', '.'] // Preserve the FULL STOP character. I.e. do not convert it to the ARABIC DECIMAL SEPARATOR indiscriminantly.
			,['.', '\u066b'] // ARABIC DECIMAL SEPARATOR
			,[',', '\u066c'] // ARABIC THOUSANDS SEPARATOR
			,['%', '\u066a'] // ARABIC PERCENT SIGN
			,['\u2030', '\u0609'] // ARABIC-INDIC PER MILLE SIGN to and from PER MILLE SIGN
			,['\u2031', '\u060a'] // ARABIC-INDIC PER TEN THOUSAND SIGN to and from PER TEN THOUSAND SIGN
			,['/', '\u060d'] // ARABIC DATE SEPARATOR
			,['0', '\u0660'] // ARABIC-INDIC DIGIT ZERO
			,['1', '\u0661'] // ARABIC-INDIC DIGIT ONE
			,['2', '\u0662'] // ARABIC-INDIC DIGIT TWO
			,['3', '\u0663'] // ARABIC-INDIC DIGIT THREE
			,['4', '\u0664'] // ARABIC-INDIC DIGIT FOUR
			,['5', '\u0665'] // ARABIC-INDIC DIGIT FIVE
			,['6', '\u0666'] // ARABIC-INDIC DIGIT SIX
			,['7', '\u0667'] // ARABIC-INDIC DIGIT SEVEN
			,['8', '\u0668'] // ARABIC-INDIC DIGIT EIGHT
			,['9', '\u0669'] // ARABIC-INDIC DIGIT NINE
			// Many of the extended arabic-indic digits characters look exactly the same
			// as their non-extended arabic-indic counterpart characters.
			// Instead of expecting users to have access to the unicode code of 
			// each character, we just treat them the same.
			,['0', '\u06f0'] // EXTENDED ARABIC-INDIC DIGIT ZERO
			,['1', '\u06f1'] // EXTENDED ARABIC-INDIC DIGIT ONE
			,['2', '\u06f2'] // EXTENDED ARABIC-INDIC DIGIT TWO
			,['3', '\u06f3'] // EXTENDED ARABIC-INDIC DIGIT THREE
			,['4', '\u06f4'] // EXTENDED ARABIC-INDIC DIGIT FOUR
			,['5', '\u06f5'] // EXTENDED ARABIC-INDIC DIGIT FIVE
			,['6', '\u06f6'] // EXTENDED ARABIC-INDIC DIGIT SIX
			,['7', '\u06f7'] // EXTENDED ARABIC-INDIC DIGIT SEVEN
			,['8', '\u06f8'] // EXTENDED ARABIC-INDIC DIGIT EIGHT
			,['9', '\u06f9'] // EXTENDED ARABIC-INDIC DIGIT NINE
			,['\u221b', '\u0606'] // ARABIC-INDIC CUBE ROOT to and from CUBE ROOT
			,['\u221c', '\u0607'] // ARABIC-INDIC FOURTH ROOT to and from FOURTH ROOT

			];
		const LATIN_COLUMN = 0;
		const ARABIC_COLUMN = 1;

		function setArabicText(text)
		{
			document.getElementById('arabicScriptText').value = text;
		}

		function getArabicText()
		{
			return document.getElementById('arabicScriptText').value;
		}

		function setLatinText(text)
		{
			document.getElementById('latinScriptText').value = text;
		}

		function getLatinText()
		{
			return document.getElementById('latinScriptText').value;
		}

		function romanizeNextChunk(arabicText)
		{
			for (var i = 0; i < transliterationTable.length; i++)
			{
				const arabicChunk = transliterationTable[i][ARABIC_COLUMN];
				const latinChunk = transliterationTable[i][LATIN_COLUMN];

				if (arabicText.startsWith(arabicChunk))
				{
					// Transliterate the next arabic chunk.
					// Also return the rest of the Arabic text.
					return [latinChunk, arabicText.substring(arabicChunk.length)];
				}
			}

			// return the next character as is, and everything else
			return [arabicText.charAt(0), arabicText.substring(1)];
		}

		function arabizeNextChunk(latinText)
		{
			for (var i = 0; i < transliterationTable.length; i++)
			{
				const arabicChunk = transliterationTable[i][ARABIC_COLUMN];
				const latinChunk = transliterationTable[i][LATIN_COLUMN];

				if (latinText.startsWith(latinChunk))
				{
					// Transliterate the next Latin chunk.
					// Also return the rest of the Latin text.
					return [arabicChunk, latinText.substring(latinChunk.length)];
				}
			}

			// return the next character as is, and everything else
			return [latinText.charAt(0), latinText.substring(1)];
		}

		function romanizationPreprocessing(text)
		{
			for (var i = 0; i < preRomanizationExclusions.length; i++)
			{
				text = text.replaceAll(preRomanizationExclusions[i], '');
			}
			return text;
		}

		function romanizeText(arabicText)
		{
			var latinText = "";
			arabicText = romanizationPreprocessing(arabicText)

			while (arabicText.length > 0)
			{
				var chunk = romanizeNextChunk(arabicText);
				latinText += chunk[0];
				arabicText = chunk[1];
			}

			return latinText;
		}

		function arabizeText(latinText)
		{
			var arabicText = "";

			while (latinText.length > 0)
			{
				var chunk = arabizeNextChunk(latinText);
				arabicText += chunk[0];
				latinText = chunk[1];
			}

			return arabicText;
		}

		function romanize()
		{
			var arabicText = getArabicText();
			var latinText = romanizeText(arabicText);
			setLatinText(latinText)
		}

		function arabize()
		{
			var latinText = getLatinText();
			var arabicText1 = arabizeText(latinText);
			const arabicText2 = arabizePostprocessing(arabicText1);
			setArabicText(arabicText2);
		}

		function addExtraAlefAfterFathatan(text)
		{
			// Add ARABIC LETTER ALEF after every ARABIC FATHATAN character
			var result = text.replaceAll("\u064b", "\u064b\u0627");

			// Remove ARABIC LETTER ALEF in every sequence ... starting with a HAMZA containing characters or ARABIC LETTER TEH MARBUTA.

			const resistantCharacters = 
			[
				'\u0629', // ARABIC LETTER TEH MARBUTA
				'\u0621', // ARABIC LETTER HAMZA
				'\u0623', // ARABIC LETTER ALEF WITH HAMZA ABOVE
				'\u0624', // ARABIC LETTER WAW WITH HAMZA ABOVE
				'\u0625', // ARABIC LETTER ALEF WITH HAMZA BELOW
				'\u0626', // ARABIC LETTER YEH WITH HAMZA ABOVE
			];

			for (var i = 0; i < resistantCharacters.length; i++)
			{
				const current = resistantCharacters[i];
				result = result.replaceAll(current + '\u064b\u0627', current + '\u064b');
			}
			return result;
		}

		function arabizePostprocessing(text)
		{
			return addExtraAlefAfterFathatan(text);
		}

		function startDeveloperMode()
		{
			document.getElementById('developerPanel').style = "visibility: visible;";
		}

		function getUnitTestResults()
		{
			return 'Unit tests are not implemented yet.';
		}

		function runUnitTests()
		{
			document.getElementById('testResultLabel').innerText = getUnitTestResults();
		}

		document.getElementById('romanizeButton').onclick = romanize;
		document.getElementById('arabizeButton').onclick = arabize;

		document.getElementById('startDeveloperModeButton').onclick = startDeveloperMode;

		document.getElementById('testButton').onclick = runUnitTests;
	</script>
</body>
</html>